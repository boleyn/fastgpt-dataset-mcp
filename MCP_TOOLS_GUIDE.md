# 🚀 智能知识库MCP工具指南

## 概述

这是一个基于MCP (Model Context Protocol) 的智能知识库搜索和问答系统，能够根据用户问题自主规划搜索策略，全方位检索知识，并生成带有出处标注的综合答案。

## 🛠️ 核心功能架构

### 1. **智能规划层** (`planning.py`)
- **问题分析器**: 自动识别问题类型和复杂度
- **搜索计划器**: 生成定制化搜索策略和任务列表
- **关键词提取**: 智能提取主要和次要关键词

### 2. **增强搜索层** (`enhanced_search.py`)
- **批量搜索**: 并发执行多个搜索任务
- **多数据集搜索**: 跨多个知识库检索
- **语义搜索**: 带上下文的智能搜索
- **结果合并**: 智能去重和排序

### 3. **答案生成层** (`answer_generation.py`)
- **答案合成器**: 根据问题类型生成结构化答案
- **引用管理**: 自动生成和格式化引用信息
- **质量评估**: 多维度评估答案质量
- **置信度计算**: 动态计算答案可信度

## 📋 MCP工具列表

### 🎯 核心工具

#### 1. `intelligent_search_and_answer`
**最强大的综合工具** - 一站式智能问答解决方案

```json
{
  "question": "亚信数字化产品都有哪些，各自的优势和应用场景是什么？",
  "available_datasets": ["683e8f11d635908ed3368af2"],
  "generate_answer": true
}
```

**功能特点**:
- ✅ 自动问题分析和搜索计划生成
- ✅ 多维度并发搜索
- ✅ 智能答案合成和引用标注
- ✅ 质量评估和置信度分析

#### 2. `generate_search_plan`
**搜索策略规划工具** - 分析问题并制定搜索策略

```json
{
  "question": "云原生技术的发展趋势如何？",
  "available_datasets": ["dataset_id_1", "dataset_id_2"]
}
```

**功能特点**:
- 📊 问题复杂度评估
- 🔍 关键词智能提取
- 📋 任务优先级排序
- 🎯 搜索策略制定

#### 3. `multi_dataset_search`
**多数据集搜索工具** - 跨知识库并发搜索

```json
{
  "dataset_ids": ["dataset_1", "dataset_2", "dataset_3"],
  "query": "人工智能应用",
  "limit_per_dataset": 5
}
```

### 🔧 基础工具

#### 4. `get_dataset_tree`
**知识库目录树工具** - 浏览知识库结构

```json
{
  "search_value": "亚信",
  "deep": 4
}
```

#### 5. `search_dataset`
**基础搜索工具** - 单数据集精确搜索

```json
{
  "dataset_id": "683e8f11d635908ed3368af2",
  "text": "数字化转型",
  "limit": 10
}
```

## 🎨 问题类型识别

系统能自动识别以下问题类型并采用相应策略：

| 问题类型 | 关键词示例 | 搜索策略 |
|---------|-----------|----------|
| **简单事实** | "什么是", "定义", "含义" | 精确匹配，快速定位 |
| **复杂分析** | "分析", "原因", "影响" | 多维度语义搜索 |
| **对比比较** | "比较", "区别", "优缺点" | 分别搜索对比对象 |
| **多方面** | "全面", "综合", "各方面" | 广度优先，全覆盖 |
| **流程解释** | "如何", "步骤", "方法" | 按流程顺序搜索 |
| **推荐建议** | "建议", "推荐", "最佳" | 搜索专家建议和最佳实践 |

## 📊 答案质量评估

系统提供多维度的答案质量评估：

- **完整性评分**: 答案内容的完整程度
- **一致性评分**: 不同来源信息的一致性
- **可靠性评分**: 基于引用质量的可信度
- **覆盖度评分**: 信息来源的多样性
- **整体置信度**: 综合评估的最终可信度

## 🚀 使用示例

### 示例1: 复杂问题全面问答

```json
{
  "tool": "intelligent_search_and_answer",
  "parameters": {
    "question": "亚信科技在5G领域的核心技术优势、产品布局和市场竞争力如何？",
    "available_datasets": ["683e8f11d635908ed3368af2"],
    "generate_answer": true
  }
}
```

**系统处理流程**:
1. 🔍 分析问题：识别为"多方面问题"，复杂度8/10
2. 📋 生成计划：创建5个搜索任务覆盖技术、产品、市场等维度
3. 🔄 并发搜索：在指定数据集中执行多维度搜索
4. 📝 合成答案：按"概述-特点-场景-优势-注意事项"结构生成
5. 📚 标注引用：自动生成[ref_1]等引用标记
6. 📊 质量评估：提供完整性、可靠性等评分

### 示例2: 搜索计划生成

```json
{
  "tool": "generate_search_plan",
  "parameters": {
    "question": "数字化转型过程中有哪些常见的挑战和解决方案？",
    "available_datasets": ["dataset_1", "dataset_2"]
  }
}
```

**输出示例**:
```markdown
# 智能搜索计划

## 🎯 用户问题
> 数字化转型过程中有哪些常见的挑战和解决方案？

## 📊 问题分析
- **问题类型**: complex_analysis
- **复杂度評分**: 7/10
- **主要关键词**: 数字化转型, 挑战, 解决方案
- **搜索策略**: 深度分析策略：多维度语义搜索，收集全面信息后综合分析

## 📋 搜索任务列表
### 任务 1: task_1
- **搜索查询**: `数字化转型`
- **优先级**: 8/10
- **搜索类型**: semantic_search
```

## 🔧 技术架构

```
用户问题
    ↓
[问题分析器] → 问题类型 + 复杂度 + 关键词
    ↓
[搜索计划器] → 搜索任务列表 + 策略
    ↓
[增强搜索器] → 并发执行 + 结果收集
    ↓
[答案生成器] → 合成答案 + 引用管理
    ↓
[质量评估器] → 多维度评分 + 建议
    ↓
格式化输出 (Markdown)
```

## 🎯 最佳实践

### 1. 选择合适的工具
- **简单查询**: 使用 `search_dataset`
- **复杂问题**: 使用 `intelligent_search_and_answer`
- **跨库搜索**: 使用 `multi_dataset_search`
- **策略分析**: 先用 `generate_search_plan`

### 2. 优化搜索效果
- 提供准确的数据集ID列表
- 使用清晰、具体的问题描述
- 根据需要调整结果数量限制

### 3. 理解输出结果
- 关注答案质量评分
- 查看引用来源的可靠性
- 根据置信度判断答案可信度

## 🔮 系统优势

### ✅ 智能化
- 自动问题分析和策略制定
- 智能关键词提取和搜索优化
- 动态答案结构生成

### ✅ 全面性
- 多维度搜索覆盖
- 跨数据集信息整合
- 完整的引用溯源体系

### ✅ 可靠性
- 多重质量评估机制
- 置信度量化计算
- 透明的处理过程

### ✅ 可扩展性
- 模块化架构设计
- 可配置的搜索策略
- 支持新数据集接入

## 📞 技术支持

如有问题或需要定制化开发，请联系开发团队。系统支持：
- 自定义问题类型识别规则
- 新增搜索策略模式
- 定制化答案生成模板
- 集成外部数据源

---
*本系统基于MCP协议构建，提供标准化的AI工具调用接口* 