# 🛠️ MCP工具使用指南

## 📖 概述

本项目提供了一套强大的知识库管理MCP工具，特别是新增的**智能文档分析**功能，能够实现从搜索到答案的一键完成工作流。

## 🎯 推荐工作流

### 方案一：智能文档分析（推荐）⭐

**一键完成：搜索 → 全文 → 答案**

```
1. smart_document_analysis
   输入问题和数据集ID → 获得完整分析报告
```

### 方案二：传统分步操作

```
1. get_dataset_tree → 了解可用数据集
2. search_dataset → 搜索定位相关文档  
3. view_collection_content → 查看完整文档内容
4. 人工分析整理答案
```

## 🛠️ 工具详细说明

### 🧠 smart_document_analysis ⭐

**最强大的智能分析工具**

**功能：**
- 🔍 在多个数据集中智能搜索
- 📊 自动识别最相关的文档
- 📖 获取文档完整内容（非片段）
- 🎯 基于全文内容进行智能分析
- ✨ 生成综合性答案和详细报告

**输入参数：**
```json
{
    "question": "您要分析的问题",
    "dataset_ids": ["数据集ID1", "数据集ID2", "..."],
    "max_docs": 5,  // 最多分析多少个文档
    "max_search_results": 20  // 每个数据集最多搜索多少个结果
}
```

**输出内容：**
- 📋 综合答案（基于完整文档内容）
- 📊 分析过程统计
- 📋 相关文档列表（含完整内容预览）
- 🔍 搜索过程详情

**使用场景：**
- ✅ 需要深度分析的复杂问题
- ✅ 需要综合多个文档的信息
- ✅ 要求高质量、准确的答案
- ✅ 希望了解完整的分析过程

---

### 📁 get_dataset_tree

**浏览知识库结构**

**功能：**
- 查看知识库的目录结构
- 获取所有可用数据集的ID和名称
- 支持关键词过滤

**输入参数：**
```json
{
    "search_value": "亚信",  // 可选：过滤关键词
    "deep": 4  // 可选：目录深度
}
```

**使用场景：**
- 🔍 了解有哪些可用的数据集
- 📋 获取数据集ID用于后续搜索
- 🗂️ 浏览知识库的组织结构

---

### 🔍 search_dataset

**单数据集精确搜索**

**功能：**
- 在指定数据集中搜索相关内容
- 返回最相关的文档片段
- 提供详细的相关性评分

**输入参数：**
```json
{
    "dataset_id": "数据集ID",
    "text": "搜索关键词",
    "limit": 10  // 可选：结果数量
}
```

**使用场景：**
- 🎯 针对特定数据集的精确搜索
- 🔍 快速定位相关文档片段
- 📊 获取相关性评分信息

---

### 📄 view_collection_content

**查看文档完整内容**

**功能：**
- 获取指定文档的所有内容块
- 显示完整的文档内容
- 提供文件下载链接

**输入参数：**
```json
{
    "collection_id": "文档ID",  // 从搜索结果中获取
    "page_size": 50  // 可选：分页大小
}
```

**使用场景：**
- 📖 查看搜索到的文档的完整内容
- 💾 获取文件下载链接
- 📋 详细了解文档的所有信息

---

### 🔍 multi_dataset_search

**多数据集快速搜索**

**功能：**
- 在多个数据集中同时搜索
- 快速了解不同数据集中的相关内容分布
- 对比不同数据集的搜索结果

**输入参数：**
```json
{
    "dataset_ids": ["ID1", "ID2", "ID3"],
    "query": "搜索关键词", 
    "limit_per_dataset": 5  // 可选：每个数据集的结果限制
}
```

**使用场景：**
- 🎯 快速了解多个数据集中的相关内容
- 📊 对比不同数据集的信息
- 🔍 为后续深度分析做准备

---

### 🤖 intelligent_search_and_answer

**传统智能搜索问答**

**功能：**
- 基于关键词的传统搜索
- 生成基于搜索片段的答案
- 制定搜索计划

**注意：** 推荐使用 `smart_document_analysis` 获得更准确的全文分析

---

### 📋 generate_search_plan

**生成搜索计划**

**功能：**
- 分析问题并生成搜索策略
- 制定任务分解计划
- 提供搜索建议

**使用场景：**
- 📋 了解复杂问题的分析策略
- 🎯 制定系统化的搜索方案

## 💡 使用建议

### 1. 简单查询
```
get_dataset_tree → search_dataset
```

### 2. 深度分析（推荐）
```
smart_document_analysis (一键完成)
```

### 3. 探索性搜索
```
get_dataset_tree → multi_dataset_search → view_collection_content
```

### 4. 定制化分析
```
generate_search_plan → smart_document_analysis
```

## 🎯 最佳实践

1. **优先使用 `smart_document_analysis`** - 最强大的一键分析工具
2. **使用 `get_dataset_tree`** - 了解可用数据集
3. **合理设置参数** - 根据需求调整 `max_docs` 和 `max_search_results`
4. **关注输出质量** - 智能分析提供的是基于完整文档的高质量答案

## 🔧 技术特点

- ✅ **全文分析**：获取完整文档内容而非片段
- ✅ **智能识别**：自动识别最相关的文档
- ✅ **统一架构**：使用统一的API客户端和服务层
- ✅ **类型安全**：Pydantic模型确保数据正确性
- ✅ **详细日志**：完整的操作日志和错误追踪
- ✅ **向后兼容**：保持与现有工具的兼容性 